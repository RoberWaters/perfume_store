{% extends 'base.html' %}

{% block title %}{{ perfume.name }} - Perfumer√≠a √âlite{% endblock %}

{% block content %}
<div class="product-detail-grid">
    <div class="product-detail-image">
        {% if perfume.image %}
        <img src="{{ perfume.image.url }}" alt="{{ perfume.name }}">
        {% else %}
        <div style="width: 100%; height: 500px; background: linear-gradient(135deg, var(--color-light) 0%, var(--color-border) 100%); display: flex; align-items: center; justify-content: center; border-radius: 12px;">
            <span style="font-size: 6rem;">‚ú®</span>
        </div>
        {% endif %}
    </div>

    <div class="product-detail-info">
        <h1>{{ perfume.name }}</h1>
        <h3 class="product-detail-brand">{{ perfume.brand.name }}</h3>
        <p class="product-detail-price">L{{ perfume.price }}</p>

        <div class="product-specs">
            <p><strong>Volumen:</strong> {{ perfume.volume_ml }} ml</p>
            <p><strong>G√©nero:</strong> {{ perfume.gender }}</p>
            <p><strong>Categor√≠a:</strong> {{ perfume.category.name }}</p>
            {% if perfume.fragrance_family %}
            <p><strong>Familia Olfativa:</strong> {{ perfume.fragrance_family }}</p>
            {% endif %}
            <p>
                <strong>Disponibilidad:</strong>
                <span class="product-stock {% if perfume.stock_quantity > 0 %}in-stock{% else %}out-of-stock{% endif %}">
                    {% if perfume.stock_quantity > 0 %}
                        ‚úì En stock ({{ perfume.stock_quantity }} disponibles)
                    {% else %}
                        ‚úó Agotado
                    {% endif %}
                </span>
            </p>
        </div>

        {% if perfume.description %}
        <div class="product-description">
            <h3 style="margin-bottom: 1rem;">Descripci√≥n</h3>
            <p>{{ perfume.description }}</p>
        </div>
        {% endif %}

        {% if perfume.stock_quantity > 0 %}
        <a href="{% url 'shop:add_to_cart' perfume.id %}" class="btn btn-large btn-accent" style="margin-top: 2rem;">
            üõí Agregar al Carrito
        </a>
        {% else %}
        <button class="btn btn-large disabled" disabled style="margin-top: 2rem;">
            Producto Agotado
        </button>
        {% endif %}
    </div>
</div>

<div class="reviews-section">
    <h2 style="text-align: center; margin-bottom: 2rem;">Rese√±as de Clientes</h2>

    {% if user.is_authenticated %}
    <div class="review-form">
        <h3 style="margin-bottom: 1.5rem;">Comparte tu experiencia</h3>
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                <label>Calificaci√≥n</label>
                <select name="rating" required>
                    <option value="">Selecciona tu calificaci√≥n...</option>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excelente</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Muy bueno</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê Bueno</option>
                    <option value="2">‚≠ê‚≠ê Regular</option>
                    <option value="1">‚≠ê Malo</option>
                </select>
            </div>
            <div class="form-group">
                <label>Comentario</label>
                <textarea name="comment" rows="4" placeholder="Cu√©ntanos qu√© te pareci√≥ este perfume..."></textarea>
            </div>
            <button type="submit" class="btn btn-accent">Publicar Rese√±a</button>
        </form>
    </div>
    {% else %}
    <p style="text-align: center; padding: 2rem; background: var(--color-light); border-radius: 12px; margin: 2rem 0;">
        <a href="{% url 'accounts:login' %}" style="color: var(--color-secondary); text-decoration: underline;">Inicia sesi√≥n</a>
        para dejar una rese√±a de este producto.
    </p>
    {% endif %}

    <div style="margin-top: 3rem;">
        {% for review in reviews %}
        <div class="review-card">
            <div class="review-header">
                <span class="review-author">{{ review.user.username }}</span>
                <span class="review-rating">
                    {% for i in "12345" %}
                        {% if forloop.counter <= review.rating %}‚≠ê{% endif %}
                    {% endfor %}
                </span>
            </div>
            {% if review.comment %}
            <p class="review-comment">{{ review.comment }}</p>
            {% endif %}
            <small class="review-date">{{ review.created_at|date:"d/m/Y" }}</small>
        </div>
        {% empty %}
        <p style="text-align: center; padding: 3rem; color: var(--color-text-light);">
            A√∫n no hay rese√±as para este producto. ¬°S√© el primero en compartir tu opini√≥n!
        </p>
        {% endfor %}
    </div>
</div>
{% endblock %}
